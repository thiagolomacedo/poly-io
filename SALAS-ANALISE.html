<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poly.io - Analise Sistema de Salas</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff;
      color: #333;
      padding: 40px;
      max-width: 900px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 3px solid #6366f1;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .logo-poly { color: #333; }
    .logo-io { color: #6366f1; }

    .subtitle {
      font-size: 1.3rem;
      color: #666;
    }

    .section {
      margin-bottom: 35px;
    }

    h2 {
      color: #6366f1;
      font-size: 1.4rem;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid #e5e7eb;
    }

    h3 {
      color: #444;
      font-size: 1.1rem;
      margin: 20px 0 10px 0;
    }

    p {
      color: #555;
      margin-bottom: 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th, td {
      padding: 10px 12px;
      text-align: left;
      border: 1px solid #e5e7eb;
    }

    th {
      background: #f3f4f6;
      color: #6366f1;
      font-weight: 600;
    }

    td {
      color: #555;
    }

    tr:nth-child(even) {
      background: #f9fafb;
    }

    .highlight {
      background: #f0f1ff;
      padding: 15px 20px;
      border-radius: 8px;
      border-left: 4px solid #6366f1;
      margin-bottom: 20px;
    }

    .highlight-title {
      color: #6366f1;
      font-weight: 600;
      margin-bottom: 8px;
    }

    ul {
      margin-left: 20px;
      margin-bottom: 15px;
    }

    li {
      color: #555;
      margin-bottom: 6px;
    }

    .check {
      color: #10b981;
      font-weight: bold;
    }

    .warning {
      color: #f59e0b;
      font-weight: bold;
    }

    pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .keyword { color: #569cd6; }
    .type { color: #4ec9b0; }
    .string { color: #ce9178; }
    .comment { color: #6a9955; }

    .flow-box {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .flow-box h4 {
      color: #6366f1;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .flow-box ol {
      margin-left: 20px;
    }

    .flow-box li {
      margin-bottom: 5px;
    }

    .arrow {
      text-align: center;
      font-size: 1.5rem;
      color: #6366f1;
      margin: 10px 0;
    }

    .questions {
      background: #fef3c7;
      border: 2px solid #f59e0b;
      border-radius: 8px;
      padding: 20px;
    }

    .questions h3 {
      color: #b45309;
      margin-top: 0;
    }

    .questions ol {
      margin-left: 20px;
    }

    .questions li {
      color: #92400e;
      margin-bottom: 8px;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
      color: #888;
      font-size: 0.9rem;
    }

    @media print {
      body {
        padding: 20px;
      }

      .flow-box, .highlight, .questions {
        break-inside: avoid;
      }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">
      <span class="logo-poly">Poly</span><span class="logo-io">.io</span>
    </div>
    <p class="subtitle">Analise do Sistema de Salas - MVP</p>
  </div>

  <div class="section">
    <h2>1. Contexto do Projeto</h2>
    <div class="highlight">
      <div class="highlight-title">Situacao Atual</div>
      <ul>
        <li>Chat com traducao automatica ja implementado</li>
        <li>Usuarios possuem login e perfil</li>
        <li>Foco em tempo real, sem historico, baixo armazenamento</li>
        <li>Mensagens e arquivos nao ficam na nuvem</li>
      </ul>
    </div>
  </div>

  <div class="section">
    <h2>2. Regras Propostas pelo Usuario</h2>

    <h3>Regras Principais</h3>
    <table>
      <tr>
        <th>#</th>
        <th>Regra</th>
        <th>Avaliacao</th>
      </tr>
      <tr>
        <td>1</td>
        <td>Cada usuario pode criar APENAS 1 sala</td>
        <td><span class="check">OK</span> - Evita spam, simples</td>
      </tr>
      <tr>
        <td>2</td>
        <td>Sala pertence ao usuario (ele e o moderador)</td>
        <td><span class="check">OK</span> - Hierarquia clara</td>
      </tr>
      <tr>
        <td>3</td>
        <td>Nao existe sala global padrao</td>
        <td><span class="check">OK</span></td>
      </tr>
      <tr>
        <td>4</td>
        <td>Salas sao publicas enquanto ativas</td>
        <td><span class="check">OK</span></td>
      </tr>
      <tr>
        <td>5</td>
        <td>Usuarios entram para conversar em tempo real</td>
        <td><span class="check">OK</span></td>
      </tr>
      <tr>
        <td>6</td>
        <td>Traducao automatica continua funcionando</td>
        <td><span class="check">OK</span></td>
      </tr>
    </table>

    <h3>Ciclo de Vida da Sala</h3>
    <table>
      <tr>
        <th>Tempo Inativo</th>
        <th>Acao</th>
      </tr>
      <tr>
        <td>7 dias</td>
        <td>Notifica o dono que a sala esta inativa</td>
      </tr>
      <tr>
        <td>15 dias</td>
        <td>Sala sai da busca publica (mas ainda existe)</td>
      </tr>
      <tr>
        <td>30 dias</td>
        <td>Sala e excluida automaticamente</td>
      </tr>
    </table>

    <h3>Regras Adicionais</h3>
    <ul>
      <li>Mensagens expiram automaticamente (ex: 1 hora)</li>
      <li>Nao existe historico de mensagens</li>
      <li>Nao armazenar mensagens traduzidas</li>
      <li>Nao armazenar arquivos (ficam no navegador do usuario)</li>
      <li>Sala so existe enquanto houver atividade</li>
    </ul>

    <h3>Moderacao</h3>
    <ul>
      <li>Criador da sala e o moderador</li>
      <li>Pode remover usuarios</li>
      <li>Pode silenciar usuarios</li>
      <li>Pode encerrar a sala</li>
    </ul>
  </div>

  <div class="section">
    <h2>3. Pontos que Precisam de Clarificacao</h2>
    <table>
      <tr>
        <th>Ponto</th>
        <th>Pergunta</th>
        <th>Sugestao</th>
      </tr>
      <tr>
        <td><strong>Expiracao 1h</strong></td>
        <td>Muito curto? Usuario entra e nao ve contexto</td>
        <td>Considerar 6h ou 24h, ou deixar dono escolher</td>
      </tr>
      <tr>
        <td><strong>Deletar sala</strong></td>
        <td>Usuario pode deletar e criar outra?</td>
        <td>Sim, faz sentido permitir</td>
      </tr>
      <tr>
        <td><strong>Limite de usuarios</strong></td>
        <td>Quantos podem estar na sala?</td>
        <td>Sugerir limite (ex: 50) para nao sobrecarregar</td>
      </tr>
      <tr>
        <td><strong>Nome da sala</strong></td>
        <td>Dono escolhe? Pode editar? Tem descricao?</td>
        <td>Definir campos obrigatorios</td>
      </tr>
      <tr>
        <td><strong>Busca</strong></td>
        <td>Como encontrar salas? Lista? Busca por nome?</td>
        <td>Definir interface de descoberta</td>
      </tr>
      <tr>
        <td><strong>Ban</strong></td>
        <td>Usuario removido pode voltar?</td>
        <td>Sugerir ban permanente daquela sala</td>
      </tr>
    </table>

    <div class="highlight">
      <div class="highlight-title">Sugestao de Ajuste no Ciclo de Vida</div>
      <p>O modelo atual penaliza salas "de nicho" que podem ter uso esporadico.</p>
      <p><strong>Alternativa:</strong></p>
      <ul>
        <li>7 dias - notificacao ao dono</li>
        <li>15 dias - sai da busca (mas quem tem link acessa)</li>
        <li>30 dias - exclui <strong>OU</strong> dono pode "renovar" com 1 clique</li>
      </ul>
    </div>
  </div>

  <div class="section">
    <h2>4. Estrutura Tecnica (Simples)</h2>

    <h3>Banco de Dados - Nova tabela "rooms"</h3>
    <pre><span class="keyword">CREATE TABLE</span> rooms (
  id <span class="type">SERIAL PRIMARY KEY</span>,
  owner_id <span class="type">INTEGER</span> <span class="keyword">REFERENCES</span> users(id),
  name <span class="type">VARCHAR(50)</span> <span class="keyword">NOT NULL</span>,
  description <span class="type">VARCHAR(200)</span>,
  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="string">NOW()</span>,
  last_activity_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="string">NOW()</span>,
  status <span class="type">VARCHAR(20)</span> <span class="keyword">DEFAULT</span> <span class="string">'active'</span>,
  max_users <span class="type">INTEGER</span> <span class="keyword">DEFAULT</span> <span class="string">50</span>,
  message_expiry_minutes <span class="type">INTEGER</span> <span class="keyword">DEFAULT</span> <span class="string">60</span>
);

<span class="comment">-- Status possiveis: active, hidden, deleted</span></pre>

    <h3>Tabela "room_bans" (opcional para MVP)</h3>
    <pre><span class="keyword">CREATE TABLE</span> room_bans (
  room_id <span class="type">INTEGER</span> <span class="keyword">REFERENCES</span> rooms(id),
  user_id <span class="type">INTEGER</span> <span class="keyword">REFERENCES</span> users(id),
  <span class="keyword">PRIMARY KEY</span> (room_id, user_id)
);</pre>

    <div class="highlight">
      <div class="highlight-title">Mensagens: NAO armazena no banco</div>
      <ul>
        <li>Ficam apenas em memoria (Map no servidor)</li>
        <li>Limpeza automatica com setInterval</li>
        <li>Custo de armazenamento: ZERO</li>
      </ul>
    </div>
  </div>

  <div class="section">
    <h2>5. Fluxo Basico</h2>

    <div class="flow-box">
      <h4>CRIAR SALA</h4>
      <ol>
        <li>Usuario clica "Criar Sala"</li>
        <li>Sistema verifica: ja tem sala? → erro</li>
        <li>Define nome + descricao (opcional)</li>
        <li>Sala criada → usuario entra automaticamente</li>
      </ol>
    </div>

    <div class="arrow">↓</div>

    <div class="flow-box">
      <h4>DESCOBRIR / ENTRAR</h4>
      <ol>
        <li>Lista de salas ativas (status = active)</li>
        <li>Mostra: nome, descricao, qtd online, dono</li>
        <li>Usuario clica → entra na sala</li>
        <li>Nao ve historico (so mensagens novas)</li>
      </ol>
    </div>

    <div class="arrow">↓</div>

    <div class="flow-box">
      <h4>CONVERSAR</h4>
      <ol>
        <li>Envia mensagem → traduz para idioma de cada usuario</li>
        <li>Broadcast para todos na sala</li>
        <li>Mensagens expiram apos X minutos (em memoria)</li>
        <li>Indicador "digitando" funciona normal</li>
      </ol>
    </div>

    <div class="arrow">↓</div>

    <div class="flow-box">
      <h4>MODERACAO</h4>
      <p>Dono ve lista de usuarios online e pode:</p>
      <ul>
        <li>Remover usuario (kick)</li>
        <li>Banir usuario (nao pode mais entrar)</li>
        <li>Silenciar usuario (so le, nao escreve)</li>
        <li>Encerrar sala (deleta imediatamente)</li>
      </ul>
    </div>

    <div class="arrow">↓</div>

    <div class="flow-box">
      <h4>CICLO DE INATIVIDADE</h4>
      <p>Job diario verifica last_activity_at:</p>
      <ul>
        <li><strong>7 dias</strong> → notifica dono (email ou in-app)</li>
        <li><strong>15 dias</strong> → status = hidden (sai da lista)</li>
        <li><strong>30 dias</strong> → status = deleted</li>
      </ul>
    </div>
  </div>

  <div class="section">
    <h2>6. Socket Events (Novos)</h2>
    <table>
      <tr>
        <th>Evento</th>
        <th>Direcao</th>
        <th>Descricao</th>
      </tr>
      <tr>
        <td><code>join-room</code></td>
        <td>Cliente → Servidor</td>
        <td>Entrar na sala</td>
      </tr>
      <tr>
        <td><code>leave-room</code></td>
        <td>Cliente → Servidor</td>
        <td>Sair da sala</td>
      </tr>
      <tr>
        <td><code>room-message</code></td>
        <td>Bidirecional</td>
        <td>Enviar/receber mensagem</td>
      </tr>
      <tr>
        <td><code>room-typing</code></td>
        <td>Bidirecional</td>
        <td>Indicador digitando</td>
      </tr>
      <tr>
        <td><code>room-users</code></td>
        <td>Servidor → Cliente</td>
        <td>Lista de usuarios online</td>
      </tr>
      <tr>
        <td><code>kick-user</code></td>
        <td>Cliente → Servidor</td>
        <td>Dono remove usuario</td>
      </tr>
      <tr>
        <td><code>ban-user</code></td>
        <td>Cliente → Servidor</td>
        <td>Dono bane usuario</td>
      </tr>
      <tr>
        <td><code>mute-user</code></td>
        <td>Cliente → Servidor</td>
        <td>Dono silencia usuario</td>
      </tr>
      <tr>
        <td><code>user-kicked</code></td>
        <td>Servidor → Cliente</td>
        <td>Notifica usuario removido</td>
      </tr>
    </table>
  </div>

  <div class="section">
    <h2>7. Reativacao de Salas</h2>
    <div class="flow-box">
      <h4>FORMAS DE REATIVAR</h4>
      <ol>
        <li><strong>Automatica:</strong> Quando uma nova mensagem e enviada na sala</li>
        <li><strong>Manual:</strong> Botao "Reativar sala" visivel apenas para o moderador</li>
      </ol>
    </div>

    <div class="highlight">
      <div class="highlight-title">Comportamento da Reativacao</div>
      <ul>
        <li>Status atualizado para 'active'</li>
        <li>Sala volta a aparecer na busca publica</li>
        <li>Contador de inatividade reiniciado (7/15/30 dias)</li>
        <li>Nenhuma mensagem historica e criada ou restaurada</li>
        <li>Nenhum dado antigo e recuperado</li>
      </ul>
    </div>
  </div>

  <div class="section">
    <h2>8. Status da Implementacao</h2>
    <div class="highlight" style="background: #d1fae5; border-left-color: #10b981;">
      <div class="highlight-title" style="color: #059669;">IMPLEMENTADO</div>
      <p style="color: #065f46;">Sistema de salas implementado na v3.0 do Poly.io</p>
    </div>
  </div>

  <div class="footer">
    <p><strong>Poly.io</strong> - Analise Sistema de Salas</p>
    <p>Documento gerado em 05 de Fevereiro de 2026</p>
  </div>

</body>
</html>
